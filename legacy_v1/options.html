<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Toss Settings</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        background: #0a0a0a;
        color: #f5f5f5;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
        padding: 24px;
      }
      h1 {
        font-size: 20px;
        margin: 0 0 4px;
      }
      p.subtle {
        color: #888;
        margin: 0 0 24px;
        font-size: 13px;
      }
      section {
        background: #111;
        border: 1px solid #1e1e1e;
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 16px;
      }
      h2 {
        font-size: 14px;
        margin: 0 0 12px;
      }
      label {
        font-size: 12px;
        color: #ccc;
      }
      select,
      input[type="text"],
      textarea {
        width: 100%;
        margin-top: 6px;
        padding: 8px 10px;
        background: #0f0f0f;
        border: 1px solid #2a2a2a;
        border-radius: 8px;
        color: #f5f5f5;
        font-size: 12px;
      }
      textarea {
        min-height: 80px;
        resize: vertical;
      }
      .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      .stack {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        background: #141414;
        border: 1px solid #2a2a2a;
        border-radius: 999px;
        font-size: 12px;
        color: #ccc;
      }
      .rules {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 10px;
      }
      .rule {
        display: grid;
        grid-template-columns: 1fr 140px 1fr 1fr auto;
        gap: 8px;
        align-items: center;
      }
      .rule input,
      .rule select {
        margin-top: 0;
      }
      button {
        cursor: pointer;
        border: 1px solid #2a2a2a;
        background: #161616;
        color: #f1f1f1;
        border-radius: 8px;
        padding: 8px 12px;
        font-size: 12px;
      }
      button.primary {
        background: linear-gradient(135deg, #8b5cf6, #06b6d4);
        border: none;
        color: #fff;
        font-weight: 600;
      }
      .checkbox-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 8px;
      }
      .status {
        font-size: 11px;
        color: #888;
        margin-top: 6px;
      }
      .custom-list {
        display: flex;
        flex-direction: column;
        gap: 6px;
        margin-top: 8px;
      }
      .custom-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #151515;
        padding: 6px 8px;
        border-radius: 8px;
        border: 1px solid #2a2a2a;
        font-size: 12px;
      }
      .custom-item span {
        color: #ddd;
      }
      .actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      .custom-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 12px;
        margin-bottom: 20px;
      }
      .directive-card {
        background: #1a1a1a;
        border: 1px solid #2a2a2a;
        border-radius: 8px;
        padding: 12px;
        transition: border-color 0.2s;
      }
      .directive-card:hover {
        border-color: #404040;
      }
      .directive-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
      }
      .directive-name {
        font-weight: 600;
        font-size: 13px;
        color: #fff;
      }
      .directive-preview {
        font-size: 11px;
        color: #888;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      .card-form {
        background: #151515;
        border: 1px solid #2a2a2a;
        border-radius: 8px;
        padding: 16px;
      }
      .card-form h4 {
        margin: 0 0 12px;
        font-size: 13px;
        color: #ddd;
      }
      summary {
        cursor: pointer;
        font-size: 12px;
        color: #888;
        user-select: none;
      }
      summary:hover {
        color: #bbb;
      }
      .input-with-icon {
        position: relative;
        display: flex;
        align-items: center;
      }
      .input-with-icon input {
        padding-right: 40px; /* Space for button */
      }
      .icon-btn {
        position: absolute;
        right: 4px;
        bottom: 4px; /* Align visually */
        background: transparent;
        border: none;
        font-size: 16px;
        padding: 4px;
        cursor: pointer;
        opacity: 0.6;
        transition: opacity 0.2s;
      }
      .icon-btn:hover {
        opacity: 1;
        background: rgba(255,255,255,0.1);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Toss Settings</h1>
      <p class="subtle">
        Tune smart routing, prompt packs, and compare defaults.
      </p>

      <section>
        <h2>Smart Routing</h2>
        <label for="routing-profile">Routing profile</label>
        <select id="routing-profile">
          <option value="off">Off</option>
          <option value="research">Research</option>
          <option value="developer">Developer</option>
          <option value="writer">Writer</option>
          <option value="custom">Custom rules</option>
        </select>

        <div class="rules" id="routing-rules"></div>
        <div class="actions">
          <button id="add-rule">Add rule</button>
        </div>
        <div class="status" id="routing-status"></div>
      </section>

      <section>
        <h2>Directives & Prompt Packs</h2>
        <div class="checkbox-grid" id="pack-list"></div>

        <div style="margin-top: 24px; border-top: 1px solid #2a2a2a; padding-top: 20px;">
          <h3>Custom Directives</h3>
          <p class="subtle" style="margin-bottom: 16px">Create specialized system prompts for your workflow.</p>
          
          <div class="custom-grid" id="custom-templates"></div>

          <div class="card-form">
            <h4>New Directive</h4>
            <div class="row">
              <div>
                <label for="custom-template-name">Name</label>
                <input
                  type="text"
                  id="custom-template-name"
                  placeholder="e.g. Legal Review, Code Audit"
                />
              </div>
              <div>
                <label for="custom-template-key">ID (Optional)</label>
                <input
                  type="text"
                  id="custom-template-key"
                  placeholder="auto-generated"
                />
              </div>
            </div>
            <label for="custom-template-prefix">System Prompt / Directive</label>
            <textarea
              id="custom-template-prefix"
              placeholder="You are an expert... Analyze the following text:"
              style="font-family: monospace; min-height: 120px;"
            ></textarea>
            <div class="actions" style="margin-top: 12px; justify-content: flex-end;">
              <button class="primary" id="add-custom-template">
                Save Directive
              </button>
            </div>
          </div>

          <div class="accordion" style="margin-top: 20px;">
            <details>
              <summary>Advanced: Import / Export JSON</summary>
              <div class="stack" style="padding-top: 12px;">
                <button id="export-custom-pack" style="width: fit-content;">Export All Directives</button>
                <label for="import-custom-pack-text">Import JSON</label>
                <textarea
                  id="import-custom-pack-text"
                  placeholder='{ "id": "custom", "name": "Custom", "templates": { ... } }'
                  style="font-family: monospace; font-size: 11px;"
                ></textarea>
                <div class="actions">
                  <button id="import-custom-pack-button">Import</button>
                </div>
                <div class="status" id="custom-status"></div>
              </div>
            </details>
          </div>
        </div>
      </section>

      <section>
        <h2>Compare Defaults</h2>
        <p class="subtle">
          Choose which LLMs are used when you launch Compare mode.
        </p>
        <div class="checkbox-grid" id="compare-targets"></div>
        <div class="status" id="compare-status"></div>
      </section>

      <section>
        <h2>Notion Integration</h2>
        <p class="subtle">
          Save selected text as blocks to a specific Notion page.
        </p>
        <div class="stack">
          <div style="display: flex; justify-content: space-between; align-items: baseline;">
            <label for="notion-token">Integration Token (Internal Integration)</label>
            <a href="https://www.notion.so/my-integrations" target="_blank" style="font-size: 11px; color: #8b5cf6; text-decoration: none;">Get Token ‚Üó</a>
          </div>
          <div class="input-with-icon">
            <input type="password" id="notion-token" placeholder="secret_..." />
            <button id="toggle-token-visibility" class="icon-btn" title="Show/Hide">
              üëÅÔ∏è
            </button>
          </div>

          <label for="notion-page-id">Page ID</label>
          <input
            type="text"
            id="notion-page-id"
            placeholder="32 character ID (from URL)"
          />

          <div class="status" id="notion-status"></div>
        </div>
      </section>
    </div>

    <!-- Add some extra spacing at bottom -->
    <div style="height: 40px"></div>

    <script src="shared.js"></script>
    <script src="options.js"></script>
  </body>
</html>
